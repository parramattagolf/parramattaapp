# 카카오톡 '나에게 보내기' 알림 시스템

이 문서는 파라마타 골프 애플리케이션에서 구현된 카카오톡 '나에게 보내기'(Memo API) 알림 기능의 구현 방식과 전송 시점, 그리고 전송되는 메시지 내용을 설명합니다.

## 1. 구현 방식

- **기술 스택**: Kakao REST API (`/v2/api/talk/memo/default/send`)
- **템플릿 유형**: 기본 텍스트 템플릿 (`object_type: 'text'`)
- **클라이언트**: `src/utils/kakao-client.ts` (`sendKakaoMeMessage` 함수)
- **인증**: 사용자의 Kakao Access Token을 사용하며, 만료 시 Refresh Token을 통해 자동 갱신 후 재전송합니다.

## 2. 주요 알림 항목

### [조인 완료] 알림

- **전송 시점**: 사용자가 특정 라운딩 방에 '조인하기'를 완료했을 때
- **수신 대상**: 조인한 본인
- **메시지 구성**:
  - **주제**: 라운딩 제목
  - **일정**: 월, 일, 요일 (시간 제외)
  - **기간**: 당일 / 1박2일 등 숙박 여부
  - **장소**: 골프장 주소/위치
  - **골프장**: 골프장 명칭
  - **가격**: 1인당 비용 (콤마 포함 포맷)
  - **동반자 리스트**: 현재 방에 참가 중인 모든 인원의 닉네임 명단
- **버튼**: '결제 완료하기' (DB의 `payment_url`이 있을 경우 해당 링크로 연결, 없을 경우 기존 조인방 상세보기 링크)

### [새로운 동반자] 알림

- **전송 시점**: 내가 참여 중인 방에 새로운 인원이 조인했을 때
- **수신 대상**: 해당 방의 호스트, 기존 방 멤버, 그리고 해당 이벤트의 사전예약자들
- **메시지 구성**:
  - **상단**: "[새로운 동반자] '...' 방에 새로운 동반자가 참여했습니다!"
  - **동반자**: 새로 들어온 사용자의 닉네임
  - (나머지 주제, 일정, 장소 정보는 위와 동일)
- **버튼**: '조인방 확인하기' (해당 룸 링크)

### [사전예약 완료] 알림

- **전송 시점**: 사용자가 이벤트 상세 페이지에서 '사전예약' 버튼을 클릭했을 때
- **수신 대상**: 사전예약한 본인
- **메시지 구성**:
  - **상단**: "[사전예약 완료] '...' 라운딩 사전예약이 완료되었습니다."
  - **하단**: "보너스 매너점수 1점이 지급되었습니다."
  - (나머지 주제, 일정, 장소 정보는 위와 동일)
- **버튼**: '라운딩 정보 보기' (이벤트 상세 링크)

## 3. 관련 파일

- `src/utils/kakao-client.ts`: 카카오 API 통신 로직 및 토큰 갱신 관리
- `src/actions/event-actions.ts`: `joinEvent`, `preReserveEvent` 함수 내에서 알림 전송 로직 호출
